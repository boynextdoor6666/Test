#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥

echo "üöÄ –ù–∞—á–∏–Ω–∞—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –ø—Ä–æ–µ–∫—Ç–∞ Tez Jumush –∫ –¥–µ–ø–ª–æ—é..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -f "deploy.env" ]; then
  echo "üîê –ù–∞–π–¥–µ–Ω —Ñ–∞–π–ª deploy.env, –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
  # –ö–æ–ø–∏—Ä—É–µ–º –≤ .env.production –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
  cp deploy.env .env.production
  echo "‚úÖ –§–∞–π–ª .env.production —Å–æ–∑–¥–∞–Ω –∏–∑ deploy.env"
else
  echo "‚ö†Ô∏è –§–∞–π–ª deploy.env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
  echo "‚ùì –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ VITE_GOOGLE_CLIENT_ID –≤ –≤–∞—à–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª deploy.env"
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏
  if [ -z "$VITE_GOOGLE_CLIENT_ID" ]; then
    echo "‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è VITE_GOOGLE_CLIENT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏"
    echo "‚ùå –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π (—Å–º. GOOGLE_AUTH_SETUP.md)"
    exit 1
  else
    echo "‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è VITE_GOOGLE_CLIENT_ID –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –ø—Ä–æ–¥–æ–ª–∂–∞—é —Å–±–æ—Ä–∫—É"
  fi
fi

# –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —É –Ω–∞—Å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
npm install

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–≤–µ—Ä—Å–∏–∏
echo "üî® –ó–∞–ø—É—Å–∫–∞—é —Å–±–æ—Ä–∫—É –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–≤–µ—Ä—Å–∏–∏..."
npm run build

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏
if [ -d "dist" ]; then
  echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –§–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ 'dist'."
  
  # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã
  if [ -f ".env.production" ]; then
    rm .env.production
    echo "üßπ –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª .env.production —É–¥–∞–ª–µ–Ω"
  fi
  
  # –ö–æ–ø–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞
  echo "üìÑ –ö–æ–ø–∏—Ä—É—é —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞..."
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è .htaccess
  if [ -f "public/.htaccess" ]; then
    echo "  - .htaccess —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω"
  else
    echo "‚ö†Ô∏è .htaccess –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–ø–∫–µ public!"
  fi
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è web.config
  if [ -f "public/web.config" ]; then
    echo "  - web.config —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω"
  else
    echo "‚ö†Ô∏è web.config –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–ø–∫–µ public!"
  fi
  
  # –í—ã–≤–æ–¥ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
  echo ""
  echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é:"
  echo "1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ 'dist' –Ω–∞ –≤–∞—à —Ö–æ—Å—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ FTP –∏–ª–∏ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è."
  echo "2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã .htaccess –∏ web.config –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ."
  echo "3. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–∞–π–ª–µ DEPLOY.md"
  
  # –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
  echo ""
  echo "üëÅÔ∏è –•–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥?"
  echo "   –ó–∞–ø—É—Å—Ç–∏—Ç–µ: npm run serve-dist"
else
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ø—Ä–æ–µ–∫—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –≤—ã—à–µ."
  
  # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
  if [ -f ".env.production" ]; then
    rm .env.production
    echo "üßπ –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª .env.production —É–¥–∞–ª–µ–Ω"
  fi
fi 